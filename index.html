<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jurnal & Jadwal Mengajar</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #224725; /* Warna utama untuk header */
      --primary-dark: #1a351d;
      --secondary: #4a7043; /* Komplemen hijau elegan */
      --accent: #d4a017; /* Aksen emas untuk sentuhan elegan */
      --light: #f5f7fa;
      --gray: #6b7280;
      --gray-dark: #374151;
      --card-bg: rgba(255, 255, 255, 0.05);
      --card-border: rgba(212, 160, 23, 0.2);
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(145deg, #1f2937 0%, #111827 100%);
      color: var(--light);
      min-height: 100vh;
      overflow-x: hidden;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }
    /* Sticky Header and Filters */
    .sticky-top {
      position: sticky;
      top: 0;
      z-index: 10;
      background: var(--primary);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    .header {
      text-align: center;
      padding: 30px 20px;
      border-bottom: 2px solid var(--accent);
      animation: slideInDown 0.8s ease;
    }
    .header h1 {
      font-size: 2.8rem;
      font-weight: 700;
      color: var(--light);
      letter-spacing: 1px;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      margin-bottom: 15px;
    }
    .header h1 i {
      margin-right: 10px;
      color: var(--accent);
    }
    .header .info {
      font-size: 1.1rem;
      color: var(--light);
      opacity: 0.9;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    .header .info span strong {
      color: var(--accent);
    }
    /* Filters Styling */
    .filters {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
      padding: 20px;
      background: var(--card-bg);
      border-radius: 0 0 16px 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(12px);
      animation: fadeIn 0.8s ease;
    }
    select, input, button {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      background: var(--gray-dark);
      color: var(--light);
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    select:hover, input:hover, button:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    select:focus, input:focus {
      outline: none;
      box-shadow: 0 0 8px var(--accent);
    }
    input[type="date"] {
      background: var(--gray-dark);
      color: var(--light);
    }
    input[type="date"]::-webkit-calendar-picker-indicator {
      filter: invert(1);
    }
    button {
      background: var(--accent);
      color: var(--primary);
      font-weight: 600;
      padding: 12px 24px;
    }
    button:hover {
      background: #e0b82f;
    }
    /* Table Styling */
    .table-wrapper {
      padding: 20px;
      background: var(--card-bg);
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(12px);
      overflow-x: auto;
      margin-top: 20px;
    }
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      border-radius: 12px;
      overflow: hidden;
      animation: fadeInUp 0.8s ease;
    }
    thead {
      background: linear-gradient(to right, var(--primary), var(--primary-dark));
      position: sticky;
      top: 0;
      z-index: 5;
    }
    th, td {
      padding: 16px 20px;
      text-align: left;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    th {
      color: var(--accent);
      font-weight: 600;
      text-transform: uppercase;
      font-size: 0.9rem;
    }
    td {
      font-size: 1rem;
      color: var(--light);
    }
    tr {
      transition: all 0.3s ease;
    }
    tr:nth-child(even) {
      background: rgba(255, 255, 255, 0.03);
    }
    tr:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: scale(1.005);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }
    td.jam-col, th.jam-col {
      white-space: nowrap;
      width: 1%;
    }
    .status-selesai {
      color: #34d399;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .status-selesai::before {
      content: '✔';
      font-size: 1rem;
    }
    .status-proses {
      color: #facc15;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .status-proses::before {
      content: '⏳';
      font-size: 1rem;
    }
    /* Kelas-specific backgrounds */
    tr.kelas-7A { background: rgba(34, 71, 37, 0.1) !important; }
    tr.kelas-7B { background: rgba(52, 211, 153, 0.1) !important; }
    tr.kelas-8A { background: rgba(245, 158, 11, 0.1) !important; }
    tr.kelas-8B { background: rgba(139, 92, 246, 0.1) !important; }
    tr.kelas-9A { background: rgba(236, 72, 153, 0.1) !important; }
    tr.kelas-9B { background: rgba(34, 197, 94, 0.1) !important; }
    /* Animations */
    @keyframes slideInDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    /* Responsive Design */
    @media (max-width: 1200px) {
      .container { max-width: 100%; padding: 15px; }
      .header h1 { font-size: 2.4rem; }
    }
    @media (max-width: 768px) {
      .header { padding: 20px 15px; }
      .header h1 { font-size: 2rem; }
      .header .info { font-size: 1rem; }
      .filters { flex-direction: column; align-items: stretch; padding: 15px; }
      select, input, button { width: 100%; margin-bottom: 10px; font-size: 0.9rem; }
      .table-wrapper { padding: 15px; }
      th, td { padding: 12px; font-size: 0.85rem; }
    }
    @media (max-width: 480px) {
      .header { padding: 15px 10px; }
      .header h1 { font-size: 1.6rem; }
      .header .info { font-size: 0.9rem; }
      .filters { padding: 10px; }
      select, input, button { padding: 10px; font-size: 0.8rem; }
      .table-wrapper { padding: 10px; }
      th, td { padding: 10px; font-size: 0.8rem; }
    }
    @media (orientation: landscape) and (max-width: 768px) {
      .filters { flex-direction: row; flex-wrap: wrap; }
      select, input, button { width: auto; margin-right: 10px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="sticky-top">
      <div class="header">
        <h1><i class="fas fa-chalkboard-teacher"></i> Jadwal Mengajar</h1>
        <div class="info">
          <span><strong>Guru:</strong> Ahmad Zaman Huri</span>
          <span><strong>Sekolah:</strong> MtsT Daarut Tahfidz Al-Ikhlas</span>
          <span><strong>Pelajaran:</strong> Bahasa Inggris</span>
        </div>
      </div>
      <div class="filters">
        <select id="filterKelas">
          <option value="">Filter Kelas</option>
        </select>
        <select id="filterBulan">
          <option value="">Filter Bulan</option>
          <option value="01">Januari</option>
          <option value="02">Februari</option>
          <option value="03">Maret</option>
          <option value="04">April</option>
          <option value="05">Mei</option>
          <option value="06">Juni</option>
          <option value="07">Juli</option>
          <option value="08">Agustus</option>
          <option value="09">September</option>
          <option value="10">Oktober</option>
          <option value="11">November</option>
          <option value="12">Desember</option>
        </select>
        <input type="date" id="filterTanggal">
        <select id="filterStatus">
          <option value="">Filter Status</option>
          <option value="selesai">Selesai</option>
          <option value="proses">Masih Proses</option>
        </select>
        <button id="resetFilters">Reset Filter</button>
      </div>
    </div>
    <div class="table-wrapper">
      <table id="kegiatanTable">
        <thead>
          <tr>
            <th>Kelas</th>
            <th class="jam-col">Jam</th>
            <th>Tanggal</th>
            <th>Hari</th>
            <th>Topik</th>
            <th>Aktivitas</th>
            <th>Target</th>
            <th>Status</th>
            <th>Keterangan</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan="9">Memuat data...</td></tr>
        </tbody>
      </table>
    </div>
  </div>
  <script>
    const SHEET_ID = "1JTwCrf7N27tuN6R3qBMzasoVPg3KixnetD9jLafrAJs";
    const SHEET_NAME = "Kegiatan";
    const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${SHEET_NAME}`;
    const filterKelas = document.getElementById("filterKelas");
    const filterBulan = document.getElementById("filterBulan");
    const filterTanggal = document.getElementById("filterTanggal");
    const filterStatus = document.getElementById("filterStatus");
    const resetBtn = document.getElementById("resetFilters");
    const tableBody = document.querySelector("#kegiatanTable tbody");
    let allData = [];

    function parseCSV(csvText) {
      const rows = [];
      let currentRow = [];
      let inQuotes = false;
      let currentValue = "";
      for (let i = 0; i < csvText.length; i++) {
        const char = csvText[i];
        const nextChar = csvText[i + 1];
        if (char === '"') {
          inQuotes = !inQuotes;
        } else if (char === ',' && !inQuotes) {
          currentRow.push(currentValue.trim());
          currentValue = "";
        } else if (char === '\n' && !inQuotes) {
          currentRow.push(currentValue.trim());
          rows.push(currentRow);
          currentRow = [];
          currentValue = "";
        } else if (char === '\r' && nextChar === '\n' && !inQuotes) {
          currentRow.push(currentValue.trim());
          rows.push(currentRow);
          currentRow = [];
          currentValue = "";
          i++;
        } else {
          currentValue += char;
        }
      }
      if (currentValue.trim() !== "" || currentRow.length > 0) {
        currentRow.push(currentValue.trim());
        rows.push(currentRow);
      }
      return rows;
    }

    function convertToISODate(dateStr) {
      if (!dateStr) return "";
      const parts = dateStr.split("/");
      if (parts.length === 3) {
        const day = parts[0].padStart(2, '0');
        const month = parts[1].padStart(2, '0');
        const year = parts[2];
        return `${year}-${month}-${day}`;
      }
      try {
        return new Date(dateStr).toISOString().split('T')[0];
      } catch {
        return "";
      }
    }

    function getMonthFromISODate(isoDate) {
      if (!isoDate) return "";
      return isoDate.split("-")[1]; // Ambil bagian bulan (MM) dari YYYY-MM-DD
    }

    function formatDisplayDate(isoDate) {
      if (!isoDate) return "";
      const parts = isoDate.split("-");
      if (parts.length === 3) {
        return `${parts[2]}/${parts[1]}/${parts[0]}`;
      }
      return isoDate;
    }

    async function loadData() {
      try {
        const response = await fetch(SHEET_URL);
        const csv = await response.text();
        const rows = parseCSV(csv);
        allData = rows.slice(1)
          .filter(r => r.length >= 9 && r[0] && r[0].trim() !== "")
          .map(row => {
            const originalDate = row[2].replace(/^"|"$/g, "");
            return {
              original: row,
              kelas: row[0].replace(/^"|"$/g, ""),
              jam: row[1].replace(/^"|"$/g, ""),
              tanggal: originalDate,
              tanggalISO: convertToISODate(originalDate),
              bulan: getMonthFromISODate(convertToISODate(originalDate)),
              topik: row[3].replace(/^"|"$/g, ""),
              aktivitas: row[4].replace(/^"|"$/g, ""),
              target: row[6].replace(/^"|"$/g, ""),
              status: row[7].replace(/^"|"$/g, "").toLowerCase(),
              keterangan: row[8].replace(/^"|"$/g, "")
            };
          })
          .sort((a, b) => new Date(b.tanggalISO) - new Date(a.tanggalISO)); // Sort by date descending
        renderTable(allData);
        fillDropdowns(allData);
      } catch (e) {
        console.error("Error loading data:", e);
        tableBody.innerHTML = `<tr><td colspan="9">Gagal memuat data. Pastikan sheet dipublish.</td></tr>`;
      }
    }

    function getDayName(dateStr) {
      if (!dateStr) return "";
      let dateObj;
      const parts = dateStr.split("/");
      if (parts.length === 3) {
        const day = parseInt(parts[0], 10);
        const month = parseInt(parts[1], 10) - 1;
        const year = parseInt(parts[2], 10);
        dateObj = new Date(year, month, day);
      } else {
        dateObj = new Date(dateStr);
      }
      if (isNaN(dateObj.getTime())) return "";
      return dateObj.toLocaleDateString("id-ID", { weekday: "long" });
    }

    function renderTable(data) {
      tableBody.innerHTML = "";
      if (data.length === 0) {
        tableBody.innerHTML = `<tr><td colspan="9">Tidak ada data</td></tr>`;
        return;
      }
      data.forEach(item => {
        const hari = getDayName(item.tanggal);
        let statusClass = "";
        let statusText = item.status;
        if (item.status.includes("selesai")) {
          statusClass = "status-selesai";
          statusText = "Selesai";
        } else if (item.status.includes("proses") || item.status.includes("masih")) {
          statusClass = "status-proses";
          statusText = "Masih Proses";
        }
        const tr = document.createElement("tr");
        const kelasClass = 'kelas-' + item.kelas.replace(/\W/g, '');
        tr.classList.add(kelasClass);
        tr.innerHTML = `
          <td>${item.kelas}</td>
          <td class="jam-col">${item.jam}</td>
          <td>${item.tanggal}</td>
          <td>${hari}</td>
          <td>${item.topik}</td>
          <td>${item.aktivitas}</td>
          <td>${item.target}</td>
          <td class="${statusClass}">${statusText}</td>
          <td>${item.keterangan}</td>
        `;
        tableBody.appendChild(tr);
      });
    }

    function fillDropdowns(data) {
      const kelasSet = new Set();
      data.forEach(item => {
        if (item.kelas) kelasSet.add(item.kelas);
      });
      filterKelas.innerHTML = '<option value="">Filter Kelas</option>';
      addOptions(filterKelas, kelasSet);
    }

    function addOptions(select, items) {
      Array.from(items).sort().forEach(item => {
        if (!item) return;
        const option = document.createElement("option");
        option.value = item;
        option.textContent = item;
        select.appendChild(option);
      });
    }

    function filterTable() {
      const kelasVal = filterKelas.value.toLowerCase();
      const bulanVal = filterBulan.value;
      const tanggalVal = filterTanggal.value;
      const statusVal = filterStatus.value.toLowerCase();
      const filtered = allData.filter(item => {
        const kelasMatch = !kelasVal || item.kelas.toLowerCase().includes(kelasVal);
        const bulanMatch = !bulanVal || item.bulan === bulanVal;
        const tanggalMatch = !tanggalVal || item.tanggalISO === tanggalVal;
        let statusMatch = true;
        if (statusVal) {
          if (statusVal === "selesai") {
            statusMatch = item.status.includes("selesai");
          } else if (statusVal === "proses") {
            statusMatch = item.status.includes("proses") || item.status.includes("masih");
          }
        }
        return kelasMatch && bulanMatch && tanggalMatch && statusMatch;
      });
      renderTable(filtered);
    }

    function resetFilters() {
      filterKelas.value = "";
      filterBulan.value = "";
      filterTanggal.value = "";
      filterStatus.value = "";
      renderTable(allData);
    }

    filterKelas.addEventListener("change", filterTable);
    filterBulan.addEventListener("change", filterTable);
    filterTanggal.addEventListener("change", filterTable);
    filterStatus.addEventListener("change", filterTable);
    resetBtn.addEventListener("click", resetFilters);
    loadData();
  </script>
</body>
</html>

